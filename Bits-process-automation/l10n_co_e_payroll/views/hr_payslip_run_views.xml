<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="hr_payslip_run_inherit_form" model="ir.ui.view">
        <field name="name">hr.payslip.run.inherit.form</field>
        <field name="model">hr.payslip.run</field>
        <field name="inherit_id" ref="hr_payroll.hr_payslip_run_form"/>
        <field name="arch" type="xml">

            <xpath expr="//button[@name='action_validate']" position="after">
                <button name="generate_epayroll_file" 
                    string="Generate EP File" 
                    type="object" 
                    class="oe_highlight"
                    attrs="{'invisible': [('dian_file_generated', '!=', True), '|', ('state', '!=', 'close'), ('ep_transaction_id', '!=', False)]}"
                />
                <button name="send_massive_file"
                    string="Send EP File" 
                    type="object" 
                    class="oe_highlight"
                    attrs="{'invisible': ['|', '|', ('state', '!=', 'close'), ('ep_transaction_id', '!=', False), ('dian_file_generated', '!=', True)]}"
                />
                <button name="send_rejected_payslip_massive_file"
                    string="Send Payslips Rejected EP File" 
                    type="object" 
                    class="oe_highlight"
                    attrs="{'invisible': [('payslip_rejected', '!=', True)]}"
                />
            </xpath>

            <xpath expr="//form/sheet/group[1]" position="after">
                <group>
                    <group>
                        <field 
                            name="payment_way_id"
                            options="{'no_open': true,
                                    'no_quick_create': true,
                                    'no_create_edit': true,
                                    'no_create':true}"
                            required="True"
                            attrs="{'readonly' : [('state', 'not in', ['draft'])]}"
                        />
                        <field name="payment_date" string="Payment Date" required="True" attrs="{'readonly' : [('state', 'not in', ['draft'])]}"/>
                     </group>
                     <group>
                        <field 
                            name="payment_method_id"
                            options="{'no_open': true,
                                    'no_quick_create': true,
                                    'no_create_edit': true,
                                    'no_create':true}"
                            required="True"
                            attrs="{'readonly' : [('state', 'not in', ['draft'])]}"
                        />
                    </group>
                </group>
            </xpath>

            <xpath expr="//sheet" position="after">
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>

            <xpath expr="//sheet" position="inside">
                <notebook>
                    <page string="Respuesta DIAN" groups="sales_team.group_sale_salesman">
                        <header>
                            <button string="DOWNLOAD DIAN INFORMATION" name="get_state_dian_massive_payslip" class="oe_highlight" type="object"/>
                            <button string="UNLINK DIAN RESPONSE LINES" name="unlink_massive_response_lines_dian" class="oe_highlight" type="object" invisible="1"/>
                        </header>
                        <group name="dian_response">
                            <group name="dian_left">
                                <field name="payslip_rejected"/>
                                <field name="dian_file_generated" readonly="True"/>
                                <field name="ep_transaction_id" readonly="True"/>
                                <field name="ep_transaction_id_history" readonly="True"/>
                            </group>
                            <group name="dian_right">
                                <field name="ep_issue_date" readonly="True"/>
                                <field name="ep_status_code" readonly="True"/>
                                <field name="ep_status_description" readonly="True"/>
                                <field name="ep_status_message" readonly="True"/>
                            </group>   
                        </group>
                        <notebook>
                            <page string="ConsultaDetalleNomina" groups="sales_team.group_sale_salesman">
                                <field name="line_detail_ids" readonly="1">
                                    <tree 
                                        decoration-success="general_status=='Aceptado'"
                                        decoration-danger="general_status=='Rechazado'"
                                    >
                                        <field name="payslip_id"/>
                                        <field name="general_status"/>
                                        <field name="request_date"/>
                                        <field name="code"/>
                                        <field name="description"/>
                                        <field name="compute_status" invisible="1"/>
                                    </tree>
                                    <form string="Detail Dian Payslip Form">
                                        <sheet>
                                            <group>
                                                <field name="payslip_id"/>
                                                <field name="general_status"/>
                                                <field name="request_date"/>
                                                <field name="code"/>
                                                <field name="description"/>
                                            </group>
                                            <field name="line_ids" >
                                                <tree>
                                                    <field name="number" />
                                                    <field name="status" />
                                                    <field name="app_response" />
                                                    <field name="xml_signed" />
                                                </tree>
                                            </field>
                                        </sheet>
                                    </form>
                                </field>
                            </page>
                            <page string="ConsultaResultadosNomina" groups="sales_team.group_sale_salesman">
                                <field name="line_result_ids" readonly="1">
                                    <tree>
                                        <field name="request_date"/>
                                        <field name="code"/>
                                        <field name="description"/>
                                        <field name="type"/>
                                        <field name="qty"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="ConsultaTotalesNomina" groups="sales_team.group_sale_salesman">
                                <field name="line_total_ids" readonly="1">
                                    <tree>
                                        <field name="request_date"/>
                                        <field name="code"/>
                                        <field name="description"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </page>
                </notebook>
            </xpath>

        </field>
    </record>
</odoo>
