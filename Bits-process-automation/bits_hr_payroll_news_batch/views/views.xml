<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record model="ir.ui.view" id="bits_hr_payroll_news_batch_form">
    <field name="name">hr.payroll.news.batch.form</field>
    <field name="model">hr.payroll.news.batch</field>
    <field name="arch" type="xml">
        <form string="Payroll News Batch">
          <header>
            <button type="object" name="compute_payroll_news_board" string="Compute" states="draft"/>
            <button name="validate" states="draft" string="Confirm" type="object" class="oe_highlight"/>
            <button name="action_set_to_close" string="Close" type="object" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'open')]}"/>
            <button name="set_to_draft" string="Set to Draft" type="object" attrs="{'invisible': [('state', '=', 'draft')]}"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,open"/>
        </header>
            <sheet>
                <div class="oe_title">
                    <h1>
                        <field name="name" force_save="1" attrs="{'readonly': True, 'required':True}"/>
                    </h1>
                </div>
                <group>
                    <group string="Basic Info">
                        <field name="payroll_structure_id"/>
                        <field name="salary_rule_id"/>
                        <field name="salary_rule_code_value"/>
                        <field name="employee_id"/>
                        <field name="number_identification"/>
                        <field name="identification_id" invisible="1"/>
                        <field name="user_id"/>
                    </group>
                    <group string="Values">
                        <field name="fixed_value" widget="monetary"
                          attrs="{'invisible': [('make_depreciation', '=', True)]}"/>
                        <field name="original_value" widget="monetary"
                          attrs="{'invisible': [('make_depreciation', '!=', True)]}"/>
                        <field name="value_residual" widget="monetary"
                          attrs="{'invisible': [('make_depreciation', '!=', True)]}"/>
                        <field name="paid_value" widget="monetary"/>
                        <field name="acquisition_date"/>
                    </group>
                    <group string="Depreciation Method">
                        <field name="make_depreciation" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        <label for="method_number" string="Duration" attrs="{'invisible': [('make_depreciation', '!=', True)]}"/>
                        <div class="o_row" attrs="{'invisible': [('make_depreciation', '!=', True)]}">
                            <field name="method_number" required="1"/>
                            <field name="method_period" required="1" nolabel="1"/>
                        </div>
                        <field name="first_depreciation_date"/>
                        <field name="date_end" readonly="1" />
                    </group>
                </group>
                <notebook colspan="4">
                    <page string="Payroll News Board" name="payroll_news_board">
                      <field name="children_ids">
                        <tree create="0" default_order="date_start asc, id asc">
                          <field name="name"/>
                          <field name="payroll_structure_id" optional="show"/>
                          <field name="salary_rule_id" optional="show"/>
                          <field name="date_start"/>
                          <field name="date_end"/>
                          <field name="date_deadline" optional="hide"/>
                          <field name="user_id" optional="hide"/>
                          <field name="sum_total"/>
                          <field name="stage_id"/>
                        </tree>
                      </field>
                    </page>
                    <page name="description_page" string="Description">
                      <field name="description" placeholder="Add a description..."/>
                      <div class="oe_clear"/>
                  </page>
                </notebook>
            </sheet>
            <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="activity_ids" widget="mail_activity"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>
        </form>
    </field>
  </record>

  <!-- explicit list view definition -->
  <record model="ir.ui.view" id="bits_hr_payroll_news_batch_list">
    <field name="name">hr.payroll.news.batch.list</field>
    <field name="model">hr.payroll.news.batch</field>
    <field name="arch" type="xml">
      <tree>
        <field name="employee_id"/>
        <field name="number_identification"/>
        <field name="salary_rule_id"/>
        <field name="salary_rule_code_value"/>
        <field name="original_value"/>
        <field name="state"/>
        <field name="first_depreciation_date"/>
        <field name="date_end" />
        <field name="method_number"/>
        <field name="create_date"/>
        <field name="description"/>
      </tree>
    </field>
  </record>

  <record model="ir.ui.view" id="bits_hr_payroll_news_batch_search">
    <field name="name">bits.hr.payroll.news.batch.search</field>
    <field name="model">hr.payroll.news.batch</field>
    <field name="arch" type="xml">
      <search>
        <field name="name" filter_domain="['|', '|', ('salary_rule_code_value', 'ilike', self), ('name', 'ilike', self), ('number_identification', 'ilike', self)]"/>
        <group expand="0" string="Group By">
          <filter name="group_employee" string="Employee" domain="[]" context="{'group_by':'employee_id'}"/>
          <filter name="group_salary_rule" string="Salary Rule" domain="[]" context="{'group_by':'salary_rule_id'}"/>
          <filter name="group_state" string="State" domain="[]" context="{'group_by':'state'}"/>
        </group>
      </search>
    </field>
  </record>

    <!-- actions opening views on models -->
    <record model="ir.actions.act_window" id="bits_hr_payroll_news_batch_action_window">
      <field name="name">bits.hr.payroll.news.batch.window</field>
      <field name="res_model">hr.payroll.news.batch</field>
      <field name="view_mode">tree,form</field>
    </record>

    <!-- actions -->
    <menuitem 
      id="bits_hr_payroll_news_batch.menu_1_list"
      name="Batch"
      sequence="30"
      parent="bits_hr_payroll_news.main_payroll_news_menu"
      action="bits_hr_payroll_news_batch_action_window"/>

    <record model="ir.actions.server" id="bits_hr_payroll_batch_compute">
      <field name="name">Compute</field>
      <field name="model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_view_types">list</field>
      <field name="state">code</field>
      <field name="code">
        if records:
          records._compute_all_payroll_news_board()
      </field>
    </record>

    <record model="ir.actions.server" id="bits_hr_payroll_batch_approved">
      <field name="name">Approve</field>
      <field name="model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_view_types">list</field>
      <field name="state">code</field>
      <field name="code">
        if records:
          records._approved_all_batch()
      </field>
    </record>

    <record model="ir.actions.server" id="bits_hr_payroll_batch_cancel">
      <field name="name">Cancel</field>
      <field name="model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_model_id" ref="bits_hr_payroll_news_batch.model_hr_payroll_news_batch"/>
      <field name="binding_view_types">list</field>
      <field name="state">code</field>
      <field name="code">
        if records:
          records.action_set_to_close()
      </field>
    </record>

</odoo>